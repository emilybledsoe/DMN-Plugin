{"version":3,"sources":["../../../src/base/viewer/Viewer.js"],"names":["Injector","core","Viewer","options","injector","_init","modules","config","createInjector","get","invoke","fire","eventBus","bootstrap","bootstrapModules","components","hasModule","m","indexOf","addModule","push","visit","__depends__","forEach","__init__","c","e","console","error","stack","concat"],"mappings":"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","sourcesContent":["import { Injector } from 'didi';\r\n\r\nimport core from './core';\r\n\r\n\r\n/**\r\n * A base for React-style viewers.\r\n */\r\nexport default class Viewer {\r\n\r\n  constructor(options = {}) {\r\n    let {\r\n      injector\r\n    } = options;\r\n\r\n    if (!injector) {\r\n      let { modules, config } = this._init(options);\r\n\r\n      injector = createInjector(config, modules);\r\n    }\r\n\r\n    this.get = injector.get;\r\n\r\n    this.invoke = injector.invoke;\r\n\r\n    this.get('eventBus').fire('viewer.init');\r\n  }\r\n\r\n  /**\r\n   * Intialize and return modules and config used for creation.\r\n   *\r\n   * @param  {Object} options\r\n   *\r\n   * @return {Object} { modules=[], config }\r\n   */\r\n  _init(options) {\r\n    let {\r\n      modules,\r\n      ...config\r\n    } = options;\r\n\r\n    return { modules, config };\r\n  }\r\n\r\n  /**\r\n   * Destroy. This results in removing the attachment from the container.\r\n   */\r\n  destroy() {\r\n    const eventBus = this.get('eventBus');\r\n\r\n    eventBus.fire('viewer.destroy');\r\n  }\r\n\r\n  /**\r\n   * Clear. Should be used to reset the state of any stateful services.\r\n   */\r\n  clear() {\r\n    const eventBus = this.get('eventBus');\r\n\r\n    eventBus.fire('viewer.clear');\r\n  }\r\n\r\n}\r\n\r\n\r\n// helpers //////////////////////\r\n\r\nfunction bootstrap(bootstrapModules) {\r\n\r\n  var modules = [],\r\n      components = [];\r\n\r\n  function hasModule(m) {\r\n    return modules.indexOf(m) >= 0;\r\n  }\r\n\r\n  function addModule(m) {\r\n    modules.push(m);\r\n  }\r\n\r\n  function visit(m) {\r\n    if (hasModule(m)) {\r\n      return;\r\n    }\r\n\r\n    (m.__depends__ || []).forEach(visit);\r\n\r\n    if (hasModule(m)) {\r\n      return;\r\n    }\r\n\r\n    addModule(m);\r\n\r\n    (m.__init__ || []).forEach(function(c) {\r\n      components.push(c);\r\n    });\r\n  }\r\n\r\n  bootstrapModules.forEach(visit);\r\n\r\n  var injector = new Injector(modules);\r\n\r\n  components.forEach(function(c) {\r\n\r\n    try {\r\n\n      // eagerly resolve component (fn or string)\r\n      injector[typeof c === 'string' ? 'get' : 'invoke'](c);\r\n    } catch (e) {\r\n      console.error('Failed to instantiate component');\r\n      console.error(e.stack);\r\n\r\n      throw e;\r\n    }\r\n  });\r\n\r\n  return injector;\r\n}\r\n\r\nfunction createInjector(config, modules) {\r\n  const bootstrapModules = [\r\n    {\r\n      config: [ 'value', config ]\r\n    },\r\n    core\r\n  ].concat(modules || []);\r\n\r\n  return bootstrap(bootstrapModules);\r\n}\r\n"],"file":"Viewer.js"}