{"version":3,"sources":["../../../../src/base/viewer/core/ChangeSupport.js"],"names":["ChangeSupport","eventBus","_listeners","on","elements","elementsChanged","element","newId","updateId","id","invoked","elementsLength","length","i","listenersLength","j","listener","idx","indexOf","splice","oldId","$inject"],"mappings":";;;;;;IAAqBA,a;;;AACnB,yBAAYC,QAAZ,EAAsB;AAAA;;AAAA;;AACpB,SAAKC,UAAL,GAAkB,EAAlB;AAEAD,IAAAA,QAAQ,CAACE,EAAT,CAAY,kBAAZ,EAAgC,gBAAkB;AAAA,UAAfC,QAAe,QAAfA,QAAe;;AAChD,MAAA,KAAI,CAACC,eAAL,CAAqBD,QAArB;AACD,KAFD;AAIAH,IAAAA,QAAQ,CAACE,EAAT,CAAY,kBAAZ,EAAgC,iBAAwB;AAAA,UAArBG,OAAqB,SAArBA,OAAqB;AAAA,UAAZC,KAAY,SAAZA,KAAY;;AACtD,MAAA,KAAI,CAACC,QAAL,CAAcF,OAAO,CAACG,EAAtB,EAA0BF,KAA1B;AACD,KAFD;AAGD;;;;oCAEeH,Q,EAAU;AACxB,UAAMM,OAAO,GAAG,EAAhB;AAEA,UAAMC,cAAc,GAAGP,QAAQ,CAACQ,MAAhC;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,cAApB,EAAoCE,CAAC,EAArC,EAAyC;AAAA,YAC/BJ,EAD+B,GACxBL,QAAQ,CAACS,CAAD,CADgB,CAC/BJ,EAD+B;;AAGvC,YAAIC,OAAO,CAACD,EAAD,CAAX,EAAiB;AACf;AACD;;AAEDC,QAAAA,OAAO,CAACD,EAAD,CAAP,GAAc,IAAd;AAEA,YAAMK,eAAe,GAAG,KAAKZ,UAAL,CAAgBO,EAAhB,KAAuB,KAAKP,UAAL,CAAgBO,EAAhB,EAAoBG,MAAnE;;AAEA,YAAIE,eAAJ,EAAqB;AACnB,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,eAApB,EAAqCC,CAAC,EAAtC,EAA0C;AAExC;AACA,iBAAKb,UAAL,CAAgBO,EAAhB,EAAoBM,CAApB,KAA0B,KAAKb,UAAL,CAAgBO,EAAhB,EAAoBM,CAApB,GAA1B;AACD;AACF;AACF;AACF;;;sCAEiBN,E,EAAIO,Q,EAAU;AAC9B,UAAI,CAAC,KAAKd,UAAL,CAAgBO,EAAhB,CAAL,EAA0B;AACxB,aAAKP,UAAL,CAAgBO,EAAhB,IAAsB,EAAtB;AACD,OAH6B,CAK9B;;;AACA,WAAKP,UAAL,CAAgBO,EAAhB,EAAoB,KAAKP,UAAL,CAAgBO,EAAhB,EAAoBG,MAAxC,IAAkDI,QAAlD;AACD;;;uCAEkBP,E,EAAIO,Q,EAAU;AAC/B,UAAI,CAAC,KAAKd,UAAL,CAAgBO,EAAhB,CAAL,EAA0B;AACxB;AACD;;AAED,UAAIO,QAAJ,EAAc;AACZ,YAAMC,GAAG,GAAG,KAAKf,UAAL,CAAgBO,EAAhB,EAAoBS,OAApB,CAA4BF,QAA5B,CAAZ;;AAEA,YAAIC,GAAG,KAAK,CAAC,CAAb,EAAgB;AACd,eAAKf,UAAL,CAAgBO,EAAhB,EAAoBU,MAApB,CAA2BF,GAA3B,EAAgC,CAAhC;AACD;AACF,OAND,MAMO;AACL,aAAKf,UAAL,CAAgBO,EAAhB,EAAoBG,MAApB,GAA6B,CAA7B;AACD;AACF;;;6BAEQQ,K,EAAOb,K,EAAO;AACrB,UAAI,KAAKL,UAAL,CAAgBkB,KAAhB,CAAJ,EAA4B;AAE1B,aAAKlB,UAAL,CAAgBK,KAAhB,IAAyB,KAAKL,UAAL,CAAgBkB,KAAhB,CAAzB;AAEA,eAAO,KAAKlB,UAAL,CAAgBkB,KAAhB,CAAP;AAED;AACF;;;;;;SAxEkBpB,a;AA2ErBA,aAAa,CAACqB,OAAd,GAAwB,CAAE,UAAF,CAAxB","sourcesContent":["export default class ChangeSupport {\r\n  constructor(eventBus) {\r\n    this._listeners = {};\r\n\r\n    eventBus.on('elements.changed', ({ elements }) => {\r\n      this.elementsChanged(elements);\r\n    });\r\n\r\n    eventBus.on('element.updateId', ({ element, newId }) => {\r\n      this.updateId(element.id, newId);\r\n    });\r\n  }\r\n\r\n  elementsChanged(elements) {\r\n    const invoked = {};\r\n\r\n    const elementsLength = elements.length;\r\n\r\n    for (let i = 0; i < elementsLength; i++) {\r\n      const { id } = elements[i];\r\n\r\n      if (invoked[id]) {\r\n        return;\r\n      }\r\n\r\n      invoked[id] = true;\r\n\r\n      const listenersLength = this._listeners[id] && this._listeners[id].length;\r\n\r\n      if (listenersLength) {\r\n        for (let j = 0; j < listenersLength; j++) {\r\n\r\n          // listeners might remove themselves before they get called\r\n          this._listeners[id][j] && this._listeners[id][j]();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  onElementsChanged(id, listener) {\r\n    if (!this._listeners[id]) {\r\n      this._listeners[id] = [];\r\n    }\r\n\r\n    // avoid push for better performance\r\n    this._listeners[id][this._listeners[id].length] = listener;\r\n  }\r\n\r\n  offElementsChanged(id, listener) {\r\n    if (!this._listeners[id]) {\r\n      return;\r\n    }\r\n\r\n    if (listener) {\r\n      const idx = this._listeners[id].indexOf(listener);\r\n\r\n      if (idx !== -1) {\r\n        this._listeners[id].splice(idx, 1);\r\n      }\r\n    } else {\r\n      this._listeners[id].length = 0;\r\n    }\r\n  }\r\n\r\n  updateId(oldId, newId) {\r\n    if (this._listeners[oldId]) {\r\n\r\n      this._listeners[newId] = this._listeners[oldId];\r\n\r\n      delete this._listeners[oldId];\r\n\r\n    }\r\n  }\r\n}\r\n\r\nChangeSupport.$inject = [ 'eventBus' ];"],"file":"ChangeSupport.js"}